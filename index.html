<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Allocations</title>
  <script src="https://cdn.jsdelivr.net/npm/@mithril/core@2.0.4/mithril.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <style>

body {
  font-family: Arial, sans-serif;
  background-color: #f5f5f5;
}

h1, h2 {
  color: #4b6584;
}

.dropdown-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.speciality-dropdown, .location-dropdown {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: #ffffff;
  border-radius: 5px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
  padding: 15px;
  margin-bottom: 15px;
  width: 100%;
}

.speciality-dropdown select, .location-dropdown select {
  display: inline-block;
  width: 100%;
  padding: 0.5rem 1rem;
  font-size: 16px;
  font-weight: bold;
  border: none;
  border-radius: 5px;
  appearance: none;
  background-color: #4b6584;
  color: #fff;
  cursor: pointer;
  margin-top: 5px;
}

.speciality-dropdown:after, .location-dropdown:after {
  content: '\25BC';
  position: absolute;

  top: 0.5rem;
  right: 1rem;
  padding: 0.5rem;
  pointer-events: none;
  color: #fff;
}

.speciality-dropdown select:focus, .location-dropdown select:focus {
  outline: none;
  box-shadow: 0px 0px 5px #ccc;
}

.speciality-dropdown:hover select, .location-dropdown:hover select {
  background-color: #367d39;
}

#allocation-table {
  margin: 1rem auto;
  border-collapse: collapse;
  width: 100%;
  max-width: 800px;
}

#allocation-table td, #allocation-table th {
  border: 1px solid #ddd;
  padding: 8px;
}

#allocation-table tr:nth-child(even) {
  background-color: #f2f2f2;
}

#allocation-table th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
  background-color: #4b6584;
  color: white;
}

#allocation-table th:hover {
  background-color: #367d39;
}

#allocation-table td a {
  color: #0000ff;
  text-decoration: underline;
}

#allocation-table td a:hover {
  color: #ff0000;
  text-decoration: none;
}
</style>
</head>
<body>
  <div class="container">
    <h1 class="text-center my-4">Allocations</h1>
    <div class="row">
      <div class="col-md-6">
        <div id="specialities-container" class="dropdown-container mb-5">
          <h2 class="text-center mb-3">Specialities</h2>
          <div id="score" class="d-flex flex-column align-items-center"></div>
        </div>
      </div>
      <div class="col-md-6">
        <div id="locations-container" class="dropdown-container mb-5">
          <h2 class="text-center mb-3">Locations</h2>
          <div id="location-score" class="d-flex flex-column align-items-center"></div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">Speciality weight:</span>
          </div>
          <input id="speciality-weight" type="number" class="form-control" min="0" max="1" step="0.01" value="0.5">
        </div>
      </div>
      <div class="col-md-6">
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">Location weight:</span>
          </div>
          <input id="location-weight" type="number" class="form-control" min="0" max="1" step="0.01" value="0.5">
        </div>
      </div>
    </div>
    <button id="update-button" class="btn btn-primary">Update Total Score</button>
    <table id="allocation-table" class="table table-bordered table-striped">
      <!-- table contents here -->
    </table>
  </div>
    <table id="allocation-table" class="table table-bordered table-striped">
      <!-- table contents here -->
    </table>
  </div>
  <script>
fetch('https://raw.githubusercontent.com/AriAb247/Ariab247.github.io/main/Allocations_sheet.csv')
  .then(response => response.text())
  .then(csv => {
    const data = Papa.parse(csv, { header: true }).data;

    // Create an array of unique specialities
    const specialities = [...new Set(data.map(d => d.speciality))];

    // Add score drop-downs to the DOM
    const scoreContainer = document.getElementById('score');
    for (let i = 0; i < specialities.length; i++) {
      const speciality = specialities[i];
      const scoreEl = document.createElement('div');
      scoreEl.innerHTML = `${speciality}: `;
      const scoreDropdown = document.createElement('select');
      scoreDropdown.setAttribute('data-speciality', speciality);
      scoreDropdown.addEventListener('change', () => {
        // Store the score in local storage
        localStorage.setItem(`scores_${speciality}`, scoreDropdown.value);

        // Update the UI
        updateTotalScores();
      });
      for (let j = -10; j <= 10; j++) {
        const option = document.createElement('option');
        option.value = j;
        option.text = j;
        scoreDropdown.appendChild(option);
      }
      scoreEl.appendChild(scoreDropdown);
      scoreContainer.appendChild(scoreEl);
    }

    // Create an array of unique locations
    const locations = [...new Set(data.map(d => d.location))];

    // Add location score drop-downs to the DOM
    const locationScoreContainer = document.getElementById('location-score');
    for (let i = 0; i < locations.length; i++) {
      const location = locations[i];
      const locationScoreEl = document.createElement('div');
      locationScoreEl.innerHTML = `${location}: `;
      const locationScoreDropdown = document.createElement('select');
      locationScoreDropdown.setAttribute('data-location', location);
      locationScoreDropdown.addEventListener('change', () => {
        // Store the location score in local storage
        localStorage.setItem(`locationScores_${location}`, locationScoreDropdown.value);

        // Update the UI
        updateTotalScores();
      });
      for (let j = -10; j <= 10; j++) {
        const option = document.createElement('option');
        option.value = j;
        option.text = j;
        locationScoreDropdown.appendChild(option);
      }
      locationScoreEl.appendChild(locationScoreDropdown);
      locationScoreContainer.appendChild(locationScoreEl);
    }

    // Add event listeners for the new input fields
    const specialityWeightInput = document.getElementById('speciality-weight');
    const locationWeightInput = document.getElementById('location-weight');
    specialityWeightInput.addEventListener('change', updateTotalScores);
    locationWeightInput.addEventListener('change', updateTotalScores);

    // Update total scores based on user input
    function updateTotalScores() {
      const specialityWeight = parseFloat(specialityWeightInput.value);
      const locationWeight = parseFloat(locationWeightInput.value);

      // Update the total score calculation using the new weights
      data.forEach(row => {
        const specialityScore = parseFloat(localStorage.getItem(`scores_${row.speciality}`) || 0);
        const locationScore = parseFloat(localStorage.getItem(`locationScores_${row.location}`) || 0);
        row.totalScore = specialityScore * specialityWeight + locationScore * locationWeight;
      });
      
      // Function to group the allocations
        function groupAllocations(data) {
          return data.reduce((acc, row) => {
            const key = row.programmeTitle;
            if (!acc[key]) {
              acc[key] = {
                programmeTitle: row.programmeTitle,
                speciality: row.speciality,
                location: row.location,
                names: [],
                totalScore: 0
              };
            }
            acc[key].names.push(row.name);
            acc[key].totalScore += row.totalScore;
            return acc;
          }, {});
        }

        // Function to update the allocation table
        function updateAllocationTable() {
          const groupedData = groupAllocations(data);
          const tableData = Object.values(groupedData);
          tableData.sort((a, b) => b.totalScore - a.totalScore);

          const table = document.getElementById('allocation-table');
          table.innerHTML = `
            <thead>
              <tr>
                <th>Names</th>
                <th>Programme Title</th>
                <th>Speciality</th>
                <th>Location</th>
                <th>Total Score</th>
              </tr>
            </thead>
            <tbody>
              ${tableData
                .map(
                  row => `
                <tr>
                  <td>${row.names.join(', ')}</td>
                  <td>${row.programmeTitle}</td>
                  <td>${row.speciality}</td>
                  <td>${row.location}</td>
                  <td>${row.totalScore.toFixed(2)}</td>
                </tr>`
                )
                .join('')}
            </tbody>
          `;
        }

        // Initialize the UI
        updateTotalScores();
      });

     
  
</script>
</body>
</html>



